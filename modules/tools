#!/usr/bin/env bash
# Module: tools
# Purpose: Install reconnaissance & information gathering tools
# Author: envertex

set -Eeuo pipefail

# =======================
# LOGGING
# =======================
CLR_INFO="\033[0;34m"
CLR_OK="\033[0;32m"
CLR_WARN="\033[1;33m"
CLR_ERROR="\033[0;31m"
CLR_RESET="\033[0m"

log_info()  { echo -e "${CLR_INFO}[INFO]${CLR_RESET}  $1"; }
log_ok()    { echo -e "${CLR_OK}[OK]${CLR_RESET}    $1"; }
log_warn()  { echo -e "${CLR_WARN}[WARN]${CLR_RESET}  $1"; }
log_error() { echo -e "${CLR_ERROR}[ERROR]${CLR_RESET} $1"; }

# =======================
# ROOT + OS CHECK
# =======================
if [[ "$EUID" -ne 0 ]]; then
  log_error "Must be run as root"
  exit 1
fi

if ! command -v pacman &>/dev/null; then
  log_error "pacman not found (Arch-based system required)"
  exit 1
fi

# =======================
# PACMAN TOOLS (CORE)
# =======================
PACMAN_TOOLS=(
  nmap
  masscan
  whois
  traceroute
  bind        # dig / nslookup
  curl
  wget
  git
  tree
  unzip
  tcpdump
  netcat
  inetutils   # ftp, telnet, whois fallback
  openssh
)

log_info "Installing core reconnaissance tools (pacman)"
pacman -S --needed --noconfirm "${PACMAN_TOOLS[@]}" &>/dev/null || true
log_ok "Core tools installed"

# =======================
# AUR / BLACKARCH TOOLS
# =======================
if command -v yay &>/dev/null; then
  log_info "Installing advanced recon tools (AUR/BlackArch)"

  AUR_TOOLS=(
    amass
    subfinder
    assetfinder
    theharvester
    dnsrecon
    dnsenum
    httprobe
    httpx
    ffuf
    gobuster
    feroxbuster
    whatweb
    wafw00f
    eyewitness
    recon-ng
    shodan
    rustscan
  )

  yay -S --needed --noconfirm "${AUR_TOOLS[@]}" &>/dev/null || true
  log_ok "Advanced recon tools installed"

else
  log_warn "yay not found, skipping AUR/BlackArch tools"
fi

# =======================
# DONE
# =======================
log_ok "Gathering & reconnaissance environment ready"
exit 0
